# Elasticapm receiver

<!-- status autogenerated section -->
| Status        |           |
| ------------- |-----------|
| Stability     | [alpha]: metrics, logs, traces   |
| Distributions | [] |
| Issues        | [![Open issues](https://img.shields.io/github/issues-search/elastic/opentelemetry-collector-components?query=is%3Aissue%20is%3Aopen%20label%3Areceiver%2Felasticapm%20&label=open&color=orange&logo=opentelemetry)](https://github.com/elastic/opentelemetry-collector-components/issues?q=is%3Aopen+is%3Aissue+label%3Areceiver%2Felasticapm) [![Closed issues](https://img.shields.io/github/issues-search/elastic/opentelemetry-collector-components?query=is%3Aissue%20is%3Aclosed%20label%3Areceiver%2Felasticapm%20&label=closed&color=blue&logo=opentelemetry)](https://github.com/elastic/opentelemetry-collector-components/issues?q=is%3Aclosed+is%3Aissue+label%3Areceiver%2Felasticapm) |
| Code coverage | [![codecov](https://codecov.io/github/elastic/opentelemetry-collector-components/graph/main/badge.svg?component=receiver_elasticapm)](https://app.codecov.io/gh/elastic/opentelemetry-collector-components/tree/main/?components%5B0%5D=receiver_elasticapm&displayType=list) |

[alpha]: https://github.com/open-telemetry/opentelemetry-collector/blob/main/docs/component-stability.md#alpha
<!-- end autogenerated section -->

Receives data via HTTP using [APM IntakeV2 format](https://www.elastic.co/docs/solutions/observability/apm/elastic-apm-events-intake-api).

## Getting started

All that is required to enable the elasticapm receiver is to include it in the receiver definitions:

```
receivers:
  elasticapm:
    agent_config:
      enabled: false
```

## Advanced configuration

The elasticapm receiver embeds the [confighttp.ServerConfig](https://github.com/open-telemetry/opentelemetry-collector/blob/main/config/confighttp/README.md), which means it supports standard HTTP server configuration, including TLS/mTLS and authentication.

### TLS and mTLS settings

You can enable TLS or mutual TLS to encrypt data in transit between Elastic APM agents and the receiver.

Example configuration:

```yaml
receivers:
  elasticapm:
    tls:
      cert_file: server.crt
      key_file: server.key
    agent_config:
      enabled: false
```

Agent environment variables:

```
ELASTIC_APM_SERVER_URL=https://localhost:8200
ELASTIC_APM_SERVER_CERT=server.crt
```

üìö OpenTelemetry TLS server configuration:
https://github.com/open-telemetry/opentelemetry-collector/blob/main/config/configtls/README.md#server-configuration

üîê Elastic APM agent TLS configuration:
https://www.elastic.co/docs/solutions/observability/apm/apm-agent-tls-communication#apm-agent-self-sign-3

### Authentication settings

In addition to TLS, you can configure authentication to ensure that only authorized agents can send data to the receiver.

The elasticapm receiver supports any [configauth authenticator](https://github.com/open-telemetry/opentelemetry-collector/blob/main/config/configauth/README.md). We recommend using the [apikeyauth extension](https://github.com/elastic/opentelemetry-collector-components/tree/main/extension/apikeyauthextension) to validate Elastic APM API keys:

```yaml
extensions:
  apikeyauth:
    endpoint: "<YOUR_ELASTICSEARCH_ENDPOINT>"
    application_privileges:
      - application: "apm"
        privileges:
          - "event:write"
        resources:
          - "-"
receivers:
  elasticapm:
    auth:
      authenticator: apikeyauth
    tls:
      cert_file: server.crt
      key_file: server.key
    agent_config:
      enabled: false
```

Agent environment variables:

```
ELASTIC_APM_API_KEY=<YOUR_ENCODED_API_KEY>
ELASTIC_APM_SERVER_URL=https://localhost:8200
ELASTIC_APM_SERVER_CERT=server.crt
```
